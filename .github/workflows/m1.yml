name: Build

on: [push]

jobs:
  build_wheels_macos:
    name: Build wheels on macos-11
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v3
      #- name: Setup Rust dependencies
      #  uses: ATiltedTree/setup-rust@v1
      #  with:
      #    rust-version: 1.65.0
      - name: Test
        run: cargo test

      - name: Build wheels
        run: |
            cd nlpo3-python
            conda activate python38
            pip install maturin
            pip list
            maturin build
            conda deactivate
            conda activate python39
            pip install maturin
            pip list
            maturin build
            conda deactivate
            conda activate python310
            pip install maturin
            pip list
            maturin build
            conda deactivate
            cd ..

      - uses: actions/upload-artifact@v3
        with:
          path: ./nlpo3-python/target/wheels/*.whl
